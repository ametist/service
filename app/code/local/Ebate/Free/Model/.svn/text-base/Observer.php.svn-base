<?php

class SD_Free_Model_Observer 
{    
    public function processOrderPlace(Varien_Event_Observer $observer)
    {
        if ($observer->getEvent()->getOrder()->getGrandTotal() != 0 && 'sdfree' != $observer->getEvent()->getOrder()->getPayment()->getMethodInstance()->getCode()) {
            return;
        }

        $order = $observer->getEvent()->getOrder();
        $invoice = $order->prepareInvoice();
        $invoice->register()->pay();
        Mage::getModel('core/resource_transaction')
            ->addObject($invoice)
            ->addObject($invoice->getOrder())
            ->save();
        $order->addStatusToHistory(
            $order->getStatus(), Mage::helper('bonuspay')->__('Order paid for free.'), $notified = true
        );                        
    }
    
}

?>
